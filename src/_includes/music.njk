---
layout: base
---

<article class="post">
    <header class="post-header">
        <h1 class="post-title">{{ title }}</h1>
        <div class="post-meta">
            <span><strong>Artist:</strong> {{ artist }}</span>
            {% if album and album != "Unknown Album" %}
            <span><strong>Album:</strong> {{ album }}</span>
            {% endif %}
            <span><strong>Release:</strong> {{ date }}</span>
            {% if genre %}
            <span><strong>Genre:</strong> {{ genre | join(", ") }}</span>
            {% endif %}
        </div>
    </header>

    {% if filename %}
    <div class="music-player" data-filename="{{ filename }}">
        <!-- Hidden HTML5 audio element for playback -->
        <audio preload="metadata" class="music-audio-player" data-filename="{{ filename }}">
            <source src="/music-files/{{ filename }}" type="{{ technical.mimeType or 'audio/mpeg' }}">
            <p>Your browser doesn't support HTML5 audio. <a href="/music-files/{{ filename }}" download>Download the track</a> instead.</p>
        </audio>

        <!-- 3-Column Card Layout -->
        <div class="music-card">
            <!-- Column 1: Album Thumbnail -->
            <div class="music-thumbnail">
                {% if albumArt %}
                <img src="{{ albumArt }}" alt="Album art for {{ title }}" class="album-art">
                {% else %}
                <div class="album-art-placeholder">
                    <div class="music-icon">‚ô™</div>
                </div>
                {% endif %}
            </div>

            <!-- Column 2: Play Controls -->
            <div class="music-controls">
                <button class="play-button" data-filename="{{ filename }}" title="Play/Pause">
                    <span class="play-icon">‚ñ∂</span>
                    <span class="pause-icon">‚è∏</span>
                </button>
                <div class="volume-control">
                    <button class="volume-button" title="Toggle Mute">üîä</button>
                    <input type="range" class="volume-slider" min="0" max="1" step="0.05" value="0.8">
                </div>
            </div>

            <!-- Column 3: Track Info and Waveform -->
            <div class="music-info">
                <div class="track-title">{{ title }}</div>
                <div class="track-artist">{{ artist }}</div>
                <div class="waveform-container">
                    {% if waveform.enabled and waveform.path %}
                    <div class="waveform" data-waveform-path="{{ waveform.path }}">
                        <img src="{{ waveform.path }}" alt="Waveform for {{ title }}" class="waveform-image">
                        <div class="waveform-overlay">
                            <div class="progress-bar">
                                <div class="progress-fill"></div>
                            </div>
                        </div>
                    </div>
                    {% else %}
                    <div class="waveform-placeholder">
                        <div class="progress-bar">
                            <div class="progress-fill"></div>
                        </div>
                    </div>
                    {% endif %}
                </div>
                <div class="time-display">
                    <span class="current-time">0:00</span>
                    <span class="duration">{{ duration | formatDuration or "--:--" }}</span>
                </div>
            </div>
        </div>

        <!-- Download Link -->
        <div class="music-download">
            <a href="/music-files/{{ filename }}" class="download-link" download>
                Download {{ technical.format or "Audio" }}
                {% if fileSize %}({{ fileSize | formatFileSize }}){% endif %}
            </a>
            {% if duration %}<span class="quality-info">{{ duration | formatDuration }} ‚Ä¢ {% endif %}
            {% if technical %}{{ technical.sampleRate / 1000 }}kHz / {{ technical.bitDepth }}bit{% endif %}
            {% if duration %}</span>{% endif %}
        </div>
    </div>
    {% endif %}

    <div class="post-content">
        {{ content | safe }}
        
        <div class="music-metadata">
            <h3>Technical Details</h3>
            <div class="technical-info">
                {% if technical %}
                <div><strong>Format:</strong> {{ technical.format or "Unknown" }}</div>
                <div><strong>Sample Rate:</strong> {{ technical.sampleRate }} Hz</div>
                {% if technical.bitDepth %}<div><strong>Bit Depth:</strong> {{ technical.bitDepth }} bit</div>{% endif %}
                <div><strong>Channels:</strong> {{ technical.channels }}</div>
                {% if technical.bitrate %}
                <div><strong>Bitrate:</strong> {{ technical.bitrate | formatFileSize }}bps</div>
                {% endif %}
                {% endif %}
                {% if fileSize %}
                <div><strong>File Size:</strong> {{ fileSize | formatFileSize }}</div>
                {% endif %}
                {% if duration %}
                <div><strong>Duration:</strong> {{ duration | formatDuration }}</div>
                {% endif %}
            </div>
        </div>

        {% if composer or performer %}
        <div class="music-credits">
            <h3>Credits</h3>
            {% if composer %}
            <div><strong>Composer:</strong> {{ composer }}</div>
            {% endif %}
            {% if performer %}
            <div><strong>Performer:</strong> {{ performer }}</div>
            {% endif %}
        </div>
        {% endif %}
    </div>
</article>